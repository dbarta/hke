<%= render 'hke/shared/community_admin_navbar' %>

<div class="container mx-auto p-4" style="direction: rtl;">

  <!-- Message Approval Dashboard -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold"><%= t('community_admin.dashboard.message_approval.title') %></h2>

      <!-- Time Filter Dropdown -->
      <div class="flex items-center space-x-4 space-x-reverse">
        <label class="text-sm font-medium text-gray-700">תקופת זמן:</label>
        <%= form_with url: hke.root_path, method: :get, local: false, data: { turbo_stream: true }, class: "inline" do |form| %>
          <%= form.select :time_filter,
              options_for_select([
                [t('community_admin.dashboard.message_approval.time_filters.one_week'), 'one_week'],
                [t('community_admin.dashboard.message_approval.time_filters.two_weeks'), 'two_weeks'],
                [t('community_admin.dashboard.message_approval.time_filters.one_month'), 'one_month'],
                [t('community_admin.dashboard.message_approval.time_filters.all'), 'all']
              ], @time_filter),
              {},
              { class: "rounded border-gray-300 text-sm", onchange: "this.form.submit();" } %>
        <% end %>
      </div>
    </div>

    <!-- Stats Line -->
    <div id="stats_line">
      <%= render partial: "stats_line", locals: { messages: @messages, time_filter: @time_filter } %>
    </div>

    <!-- Bulk Actions -->
    <div class="flex gap-4 mb-4 p-4 bg-gray-50 rounded-lg border">
      <%= button_to t('community_admin.dashboard.message_approval.bulk_actions.approve_all'),
          approve_all_future_messages_path(time_filter: @time_filter),
          method: :post,
          form: { data: { turbo: true }, class: "inline" },
          class: "btn btn-secondary" %>
      <%= button_to t('community_admin.dashboard.message_approval.bulk_actions.disapprove_all'),
          disapprove_all_future_messages_path(time_filter: @time_filter),
          method: :post,
          form: { data: { turbo: true }, class: "inline" },
          class: "btn btn-danger" %>
    </div>

    <!-- Messages Table -->
    <div id="messages_table">
      <%= render partial: "messages_approval_table", locals: { messages: @messages, time_filter: @time_filter } %>
    </div>
  </div>


</div>
