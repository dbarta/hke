<%= render 'hke/shared/community_admin_navbar' %>

<div class="container mx-auto p-4" style="direction: rtl;">

  <!-- Message Approval Dashboard -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold"><%= t('community_admin.dashboard.message_approval.title') %></h2>

      <!-- Time Filter Dropdown -->
      <div class="flex items-center space-x-4 space-x-reverse">
        <label class="text-sm font-medium text-gray-700">תקופת זמן:</label>
        <%= form_with url: hke.root_path, method: :get, local: false, data: { turbo_stream: true }, class: "inline" do |form| %>
          <%= form.select :time_filter,
              options_for_select([
                [t('community_admin.dashboard.message_approval.time_filters.one_week'), 'one_week'],
                [t('community_admin.dashboard.message_approval.time_filters.two_weeks'), 'two_weeks'],
                [t('community_admin.dashboard.message_approval.time_filters.one_month'), 'one_month'],
                [t('community_admin.dashboard.message_approval.time_filters.all'), 'all']
              ], @time_filter),
              {},
              { class: "rounded border-gray-300 text-sm", onchange: "this.form.submit();" } %>
        <% end %>
      </div>
    </div>

    <!-- Messages Approval Form -->
    <%= form_with url: bulk_approve_future_messages_path, method: :post, local: true, id: "approval_form" do |form| %>
      <!-- Bulk Actions -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex space-x-4 space-x-reverse">
          <button type="button" id="approve_all_btn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
            <%= t('community_admin.dashboard.message_approval.bulk_actions.approve_all') %>
          </button>
          <button type="button" id="disapprove_all_btn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
            <%= t('community_admin.dashboard.message_approval.bulk_actions.disapprove_all') %>
          </button>
        </div>
        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          <%= t('community_admin.dashboard.message_approval.bulk_actions.submit') %>
        </button>
      </div>

      <!-- Messages Table -->
      <div id="messages_table">
        <%= render partial: "messages_approval_table", locals: { messages: @messages, time_filter: @time_filter } %>
      </div>
    <% end %>
  </div>

  <!-- JavaScript for Bulk Actions -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const approveAllBtn = document.getElementById('approve_all_btn');
      const disapproveAllBtn = document.getElementById('disapprove_all_btn');

      if (approveAllBtn) {
        approveAllBtn.addEventListener('click', function() {
          const checkboxes = document.querySelectorAll('input[name="approved_message_ids[]"]');
          checkboxes.forEach(checkbox => checkbox.checked = true);
        });
      }

      if (disapproveAllBtn) {
        disapproveAllBtn.addEventListener('click', function() {
          const checkboxes = document.querySelectorAll('input[name="approved_message_ids[]"]');
          checkboxes.forEach(checkbox => checkbox.checked = false);
        });
      }
    });
  </script>
</div>
